{% extends 'store/base.html' %}
{% block title %}Checkout{% endblock %}

{% block content %}
<div class="container my-5">
    <div class="row justify-content-center">
        <div class="col-md-6">

            <div class="card shadow">
                <div class="card-header bg-dark text-white d-flex align-items-center">
    
    <a href="javascript:history.back()" class="btn btn-light btn-sm me-3">
        ← 
    </a>

    <span>Checkout</span>
</div>

                <div class="card-body">
                        <div class="mb-3">
        
                </div>
                         
                        <div id="address-section">

    <div class="mb-3">
        <label>Quantity</label>
        <input type="number" id="quantity" class="form-control" value="1" min="1">
        <input type="hidden" id="product-price" value="{{ product.price }}">

    </div>

    <h5>Delivery Address</h5>

    <input type="text" id="full_name" class="form-control mb-2" placeholder="Full Name">
    <textarea id="address" class="form-control mb-2" placeholder="Full Address" ></textarea>

    <div class="row">
        <div class="col">
            <input type="text" id="city" class="form-control" placeholder="City">
        </div>
        <div class="col">
            <input type="text" name="pincode" id="pincode"
               class="form-control" placeholder="Pincode"
               pattern="[0-9]{6}">
        </div>
    </div>

    <button type="button"
            class="btn btn-success mt-3"
            onclick="validateAndContinue()">
        Continue
    </button>

</div>
<div id="payment-section" style="display:none; margin-top:30px;">
   <b><p>Total Amount: ₹<span id="total-amount">0.00</span></p></b>
    <h3>Select Payment Method</h3>
    
    <form method="post">
        {% csrf_token %}
         
        <label>
            <input type="radio" name="payment_method" value="COD" required>
            Cash on Delivery
        </label><br>

        <label>
            <input type="radio" name="payment_method" value="UPI">
            UPI
        </label><br>

        <label>
            <input type="radio" name="payment_method" value="BANK">
            Bank Transfer
        </label><br><br>

        <button type="submit">Place Order</button>
    </form>
</div>

<script>
function validateAndContinue() {

    const quantity = parseInt(document.getElementById("quantity").value);
    const price = parseFloat(document.getElementById("product-price").value);

    const name = document.getElementById("full_name").value.trim();
    const address = document.getElementById("address").value.trim();
    const city = document.getElementById("city").value.trim();
    const pincode = document.getElementById("pincode").value.trim();

    if (!name || !address || !city || !pincode) {
        alert("Please fill all delivery details");
        return;
    }

    if (!/^[0-9]{6}$/.test(pincode)) {
        alert("Enter a valid 6-digit pincode");
        return;
    }

    const total = quantity * price;
    document.getElementById("total-amount").innerText = total.toFixed(2);

    document.getElementById("address-section").style.display = "none";
    document.getElementById("payment-section").style.display = "block";
}
</script>


{% endblock %}
